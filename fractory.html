
<!-- saved from url=(0036)https://jamuspsi.github.io/fractory/ -->
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<script async="" src="./fractory_files/analytics.js"></script><script type="text/javascript" src="./fractory_files/jquery-1.10.2.js"></script>
	<script type="text/javascript" src="./fractory_files/classy.js"></script>
	<link href="./fractory_files/jquery-ui-1.10.3.custom.css" rel="stylesheet">
	<link href="./fractory_files/jquery.qtip.css" rel="stylesheet">
	<script src="./fractory_files/jquery-ui-1.10.3.custom.js"></script>
	<script src="./fractory_files/underscore.js"></script>

	<link rel="stylesheet" type="text/css" href="./fractory_files/game-icons.css">
	<link rel="stylesheet/less" type="text/css" href="./fractory_files/style.less"><style type="text/css" id="less:fractory-less-style">body {
  color: white;
  background-color: #222;
}
scene_holder {
  width: 910px;
  height: 620px;
}
.qtip{
    min-width: 400px;
}
.scene {
  border: 1px dotted white;
  position: relative;
  width: 910px;
  height: 620px;
}
.shell {
  border: 1px dotted red;
  position: absolute;
}
.shell .links {
  position: absolute;
  overflow: hidden;
  width: 720px;
  height: 640px;
}
.shell_holder {
  position: relative;
  width: 720px;
  height: 640px;
  float: left;
  margin-left: 5px;
  margin-right: 5px;
}
.inventory_holder {
  width: 230px;
  float: left;
}

.part_sandbox{
    width: 1250px;
}
.inventory_holder .inventory_label {
  font-size: 18pt;
  font-weight: bold;
  text-align: center;
  padding-bottom: 3px;
}
.shop_bar {
  width: 290px;
  float: left;
}
.shop_bar .shop_label {
  font-size: 18pt;
  font-weight: bold;
  text-align: center;
  padding-bottom: 3px;
}
.shop_price {
  font-size: 10pt;
}
.shop_bar .shop_slot_label {
  text-decoration: underline;
  text-align: center;
}
.shop_bar .shop_slot_holder .shop_entry {
  text-align: center;
  background-color: #444;
  float: left;
  margin-right: 4px;
  margin-bottom: 4px;
  width: 90px;
  height: 145px;
  padding: 1px;
}
.shop_bar .shop_slot_holder .shop_entry .shop_slot {
  position: relative;
  width: 60px;
  height: 60px;
  display: inline-block;
}
.shop_bar .shop_slot_holder button {
  padding: 1px 1px;
  font-size: 8pt;
  font-weight: bold;
}
.ui-dialog-title {
  font-size: 8pt !important;
  margin: 2px !important;
}
.ui-dialog-titlebar {
  padding: 4px 5px !important;
}
.node {
  z-index: 1;
  border: 1px dotted green;
  position: absolute;
}
.part_holder {
  position: absolute;
  width: 60px;
  height: 60px;
  top: 0px;
  left: 0px;
}
.part {
  position: absolute !important;
  left: 0;
  top: 0;
  width: 60px;
  height: 60px;
}
.inventory_slot {
  position: relative;
  width: 60px;
  height: 60px;
  border: 2px dotted orange;
  margin-right: 10px;
  margin-top: 10px;
  display: inline-block;
}
.trash_slot {
  position: relative;
  width: 60px;
  height: 60px;
  border: 2px dotted red;
  margin-right: 10px;
  margin-top: 10px;
  display: inline-block;
  background-color: rgba(255, 225, 225, 0.8);
}
.link {
  background-color: rgba(0, 255, 255, 0.1);
  position: absolute;
  overflow: hidden;
}
.link.active {
  background-color: rgba(0, 255, 128, 0.5);
}
.link.active.side {
  background-color: rgba(128, 128, 40, 0.5);
}
.link.active.disconnected {
  background-color: rgba(128, 40, 40, 0.5);
}
.link .flow_arrow {
  text-align: center;
}
.paused .link.active {
  background-color: rgba(0, 0, 128, 0.5);
}
.stat_table .stat_row {
  font-size: 8pt;
}
.stat_table .stat_row .stat_noun {
  font-weight: bold;
  color: white;
}
.stat_table .stat_row .total .value {
  color: #3f3;
  font-weight: bold;
}
.stat_table .stat_row .total .buff {
  color: cyan;
  font-style: italic;
}
.stat_table .stat_row .description {
  width: 300px;
}
.stat_table .stat_row .description .factor {
  color: yellow;
  font-weight: bold;
}
img.flip {
  transform: scale(-1, 1);
  -moz-transform: scale(-1, 1);
  -webkit-transform: scale(-1, 1);
  -o-transform: scale(-1, 1);
  -khtml-transform: scale(-1, 1);
  -ms-transform: scale(-1, 1);
}
img.fill_img {
  position: absolute;
  left: 0px;
  top: 0px;
  width: 100%;
  height: 100%;
}
.clickthrough {
  pointer-events: none;
}
.clear {
  clear: inherit;
}
.refinement_bar {
  width: 100%;
  height: 20px;
}
.infusion_bar {
  width: 100%;
  height: 20px;
}
.infusion_bar .ui-progressbar-value {
  background: #00ffff url(https://jamuspsi.github.io/fractory/less/images/ui-bg_hexagon_16_af511a_12x10.png) 50% 50% repeat;
}
.progressbar_with_overlay {
  position: relative;
}
.progressbar_with_overlay .progressbar {
  position: absolute;
  width: 100%;
  height: 100%;
}
.progressbar_with_overlay .overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.trash_label {
  margin-top: 10px;
}
.status_bar {
  width: 800px;
  margin-top: 20px;
  margin-left: 75px;
}
.status_bar .mana {
  color: aquamarine;
}
.status_bar .spent {
  color: pink;
}
.status_bar .generated {
  color: green;
}
.panes {
  width: 800px;
  margin-left: 75px;
  margin-bottom: 300px;
}
.panes .pane_chooser {
  text-align: center;
}
.panes .pane {
  margin-top: 5px;
  text-align: center;
  width: 100%;
}
.panes .pane.game_stats {
  width: 110%;
}
.panes .pane.game_stats table.game_stats {
  float: left;
}
.panes .pane.game_stats .info_part {
  padding: 10px;
  border: 1px solid yellow;
  float: left;
  margin-left: 100px;
}
.panes .pane.research table {
  width: 90%;
  margin-left: auto;
  margin-right: auto;
  border-collapse: collapse;
}
.panes .pane.research table td {
  padding: 3px 15px;
}
.panes .pane.research .available_research .name {
  font-weight: bold;
}
.panes .pane.research .available_research .mana_cost {
  text-align: right;
}
.panes .pane.research .available_research.cannot_buy {
  background-color: rgba(255, 0, 0, 0.2);
}
.panes .pane.research .available_research.learned {
  background-color: green;
}
.panes .pane.research .available_research.can_buy {
  background-color: rgba(255, 255, 0, 0.2);
}
.panes .pane.shop {
  text-align: left;
}
.panes .pane.shop .shop_settings {
  float: left;
  width: 720px;
  margin-left: 5px;
}
.panes .pane.shop .shop_settings tr td {
  padding-bottom: 9px;
}
.panes .pane.shop .shop_settings th {
  padding-right: 10px;
}
.panes .pane.shop .shop_settings .shop_choose_button {
  display: inline-block;
  margin-right: 10px;
  padding: 5px;
  border: 1px solid silver;
  cursor: pointer;
  -webkit-touch-callout: none;
  /* iOS Safari */

  -webkit-user-select: none;
  /* Chrome/Safari/Opera */

  -khtml-user-select: none;
  /* Konqueror */

  -moz-user-select: none;
  /* Firefox */

  -ms-user-select: none;
  /* Internet Explorer/Edge */

  user-select: none;
  /* Non-prefixed version, currently
                                  not supported by any browser */

}
.panes .pane.shop .shop_settings .shop_choose_button.active {
  background-color: white;
  color: black;
}
.panes .pane.shop .shop_settings .action_button {
  display: inline-block;
  margin-right: 10px;
  padding: 5px;
  border: 1px solid silver;
  cursor: pointer;
  -webkit-touch-callout: none;
  /* iOS Safari */

  -webkit-user-select: none;
  /* Chrome/Safari/Opera */

  -khtml-user-select: none;
  /* Konqueror */

  -moz-user-select: none;
  /* Firefox */

  -ms-user-select: none;
  /* Internet Explorer/Edge */

  user-select: none;
  /* Non-prefixed version, currently
                                  not supported by any browser */

}
.panes .pane.shop .shop_settings .action_button.reroll {
  color: red;
}
.noselect {
  -webkit-touch-callout: none;
  /* iOS Safari */

  -webkit-user-select: none;
  /* Chrome/Safari/Opera */

  -khtml-user-select: none;
  /* Konqueror */

  -moz-user-select: none;
  /* Firefox */

  -ms-user-select: none;
  /* Internet Explorer/Edge */

  user-select: none;
  /* Non-prefixed version, currently
                                  not supported by any browser */

}
.button {
  display: inline-block;
  margin-right: 10px;
  padding: 5px;
  border: 1px solid silver;
  cursor: pointer;
  -webkit-touch-callout: none;
  /* iOS Safari */

  -webkit-user-select: none;
  /* Chrome/Safari/Opera */

  -khtml-user-select: none;
  /* Konqueror */

  -moz-user-select: none;
  /* Firefox */

  -ms-user-select: none;
  /* Internet Explorer/Edge */

  user-select: none;
  /* Non-prefixed version, currently
                                  not supported by any browser */

}
.pane_chooser {
  margin-top: 10px;
}
.pane_button {
  display: inline-block;
  margin-right: 10px;
  padding: 5px;
  border: 1px solid silver;
  -webkit-touch-callout: none;
  /* iOS Safari */

  -webkit-user-select: none;
  /* Chrome/Safari/Opera */

  -khtml-user-select: none;
  /* Konqueror */

  -moz-user-select: none;
  /* Firefox */

  -ms-user-select: none;
  /* Internet Explorer/Edge */

  user-select: none;
  /* Non-prefixed version, currently
                                  not supported by any browser */

  cursor: pointer;
}
.pane_button.active {
  background-color: white;
  color: black;
}
table.horiz_stats {
  border: 2px solid white;
  margin: 0 auto 0 auto;
}
table.horiz_stats th {
  text-align: center;
  text-decoration: underline;
}
table.horiz_stats td {
  text-align: center;
}
table.horiz_stats th,
table.horiz_stats td {
  padding: 0 15px 0 15px;
}
table.shop_table {
  border-collapse: collapse;
  margin: 10px auto 0 auto;
}
table.shop_table tbody tr {
  padding-top: 3px;
  padding-bottom: 3px;
  border-top: 1px solid silver;
  border-bottom: 1px solid silver;
}
table.shop_table tbody tr span.line {
  display: block;
}
table.shop_table tbody tr:hover {
  background-color: #010101;
}
table.shop_table th,
table.shop_table td {
  padding: 5px 15px 5px 15px;
}
tr.available_upgrade {
  cursor: pointer;
}
div#game_render {
  width: 1250px;
  padding-left: 0px;
}
.icon-mana {
  background-image: url('https://jamuspsi.github.io/fractory/less/../images/icons/mana.png');
  background-size: 100% 100%;
  width: 16px;
  height: 16px;
  display: inline-block;
}
.full_reset {
  margin-top: 900px;
}
.full_reset button {
  font-size: 6pt;
  color: red;
  font-weight: bold;
}
</style>
	<link rel="stylesheet/less" type="text/css" href="./fractory_files/glyphs.less"><style type="text/css" id="less:fractory-less-glyphs">.glyph_holder {
  position: absolute;
  left: 0px;
  top: 0px;
  height: 100%;
  width: 100%;
}
.glyph_holder .glyph {
  position: absolute;
  color: black;
  vertical-align: middle;
  text-align: center;
  font-size: 15pt;
}
.glyph_holder.one_glyph .glyph1 {
  left: 11px;
  top: 12px;
  width: 36px;
  height: 36px;
  line-height: 60px;
  background-size: 100% 100%;
}
.glyph_holder.two_glyphs .glyph1 {
  top: 20px;
  left: 10px;
  width: 20px;
  height: 20px;
  background-size: 100% 100%;
}
.glyph_holder.two_glyphs .glyph2 {
  top: 21px;
  left: 34px;
  width: 17px;
  height: 17px;
  background-size: 100% 100%;
}
.glyph_holder.three_glyphs .glyph1 {
  top: 14px;
  left: 12px;
  width: 20px;
  height: 20px;
  background-size: 100% 100%;
}
.glyph_holder.three_glyphs .glyph2 {
  top: 17px;
  left: 32px;
  width: 18px;
  height: 18px;
  background-size: 100% 100%;
}
.glyph_holder.three_glyphs .glyph3 {
  top: 36px;
  width: 15px;
  height: 15px;
  left: 22px;
  background-size: 100% 100%;
}
@font-face {
  font-family: magi;
  src: url(https://jamuspsi.github.io/fractory/less/../fonts/alpmagi.ttf);
}
.magi {
  /*font-family: magi;*/

}
.icon-brilliance {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/barbed-sun.png');
}
.icon-radiance {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/beveled-star.png');
}
.magi_c {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/barbed-sun.png');
}
.icon-glow {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/divided-spiral.png');
}
.icon-mystery {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/abstract-002.png');
}
.icon-waxing {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/abstract-062.png');
}
.icon-conductivity {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/nodular.png');
}
.icon-infusing {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/concentric-crescents.png');
}
.icon-imbuing {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/doubled.png');
}
.icon-arcana {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/cursed-star.png');
}
.icon-vividity {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/maze-saw.png');
}
.icon-power {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/zigzag-cage.png');
}
.icon-shine {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/shiny-entrance.png');
}
.icon-lens {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/microscope-lens.png');
}
.icon-prism {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/crystal-eye.png');
}
.icon-shimmer {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/floating-crystal.png');
}
.icon-seal {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/abstract-118.png');
}
.icon-resonance {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/abstract-014.png');
}
.icon-flux {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/coiling-curl.png');
}
.icon-purity {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/holosphere.png');
}
.icon-reflection {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/over-infinity.png');
}
.icon-gleam {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/moebius-triangle.png');
}
.icon-core {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/nested-hexagons.png');
}
.icon-relay {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/abstract-065.png');
}
.icon-conduit {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/abstract-051.png');
}
.icon-capacitor {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/abstract-064.png');
}
.icon-hopper {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/abstract-027.png');
}
.magi_y {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/barbed-sun.png');
}
.magi_z {
  /*font-family: magi;*/

  background: url('https://jamuspsi.github.io/fractory/less/../images/icons/barbed-sun.png');
}
/*
.magi_b {
    .magi; &:after {content: "b"}
}
.magi_c {
    .magi; &:after {content: "c"}
}
.magi_d {
    .magi; &:after {content: "d"}
}
.magi_e {
    .magi; &:after {content: "e"}
}
.magi_f {
    .magi; &:after {content: "f"}
}
.magi_g {
    .magi; &:after {content: "g"}
}
.magi_h { .magi; &:after { content: "h"; } }
.magi_i { .magi; &:after { content: "i"; } }
.magi_j { .magi; &:after { content: "j"; } }
.magi_k { .magi; &:after { content: "k"; } }
.magi_l { .magi; &:after { content: "l"; } }
.magi_m { .magi; &:after { content: "m"; } }
.magi_n { .magi; &:after { content: "n"; } }
.magi_o { .magi; &:after { content: "o"; } }
.magi_p { .magi; &:after { content: "p"; } }
.magi_q { .magi; &:after { content: "q"; } }
.magi_r { .magi; &:after { content: "r"; } }
.magi_s { .magi; &:after { content: "s"; } }
.magi_t { .magi; &:after { content: "t"; } }
.magi_u { .magi; &:after { content: "u"; } }
.magi_v { .magi; &:after { content: "v"; } }
.magi_w { .magi; &:after { content: "w"; } }
.magi_x { .magi; &:after { content: "x"; } }
.magi_y { .magi; &:after { content: "y"; } }
.magi_z { .magi; &:after { content: "z"; } }
*/</style>
        <link rel="stylesheet/less" type="text/css" href="./fractory_files/links_anim.less"><style type="text/css" id="less:fractory-less-links_anim">#outer-barG {
  height: 31px;
  width: 109px;
  border: 2px solid #000000;
  overflow: hidden;
  background-color: #ffffff;
  margin: auto;
}
.stripe_holder {
  height: 100%;
  overflow: hidden;
}
.stripe_holder.up {
  transform: rotate(180deg);
}
.stripe_holder.side {
  height: 0;
}
.stripe_holder.disconnected,
.stripe_holder.inactive {
  height: 0;
}
.link_stripe {
  overflow: hidden;
  background-color: white;
  float: right;
  width: 12px;
  height: 102px;
  margin-right: 15px;
  margin-top: -50px;
  transform: rotate(45deg);
  -o-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
}
.inner_stripe_holder {
  transform: translate(-100%, 0);
  width: 100%;
  height: 100%;
  animation-name: bar-animationG;
  -o-animation-name: bar-animationG;
  -ms-animation-name: bar-animationG;
  -webkit-animation-name: bar-animationG;
  -moz-animation-name: bar-animationG;
  animation-duration: 1.75s;
  -o-animation-duration: 1.75s;
  -ms-animation-duration: 1.75s;
  -webkit-animation-duration: 1.75s;
  -moz-animation-duration: 1.75s;
  animation-iteration-count: infinite;
  -o-animation-iteration-count: infinite;
  -ms-animation-iteration-count: infinite;
  -webkit-animation-iteration-count: infinite;
  -moz-animation-iteration-count: infinite;
  animation-direction: normal;
  -o-animation-direction: normal;
  -ms-animation-direction: normal;
  -webkit-animation-direction: normal;
  -moz-animation-direction: normal;
  animation-timing-function: linear;
}
@keyframes bar-animationG {
  0% {
    transform: translate(-100%, 0);
  }
  100% {
    transform: translate(100%, 0);
  }
}
</style>
        <script type="text/javascript">less = { env: 'development' };</script>
        <script type="text/javascript" src="./fractory_files/less-1.3.3.min.js"></script>

        <script type="text/javascript" src="./fractory_files/knockout-3.4.0.ice_fork.js"></script>
        <script type="text/javascript" src="./fractory_files/raphael.min.js"></script>
        <script type="text/javascript" src="./fractory_files/interact.min.js"></script>

        <script type="text/javascript" src="./fractory_files/jquery.qtip.min.js"></script>

        <script src="./fractory_files/ice.js"></script>
        <script src="./fractory_files/ko_extenders.js"></script>
        <script src="./fractory_files/templates.js"></script>
        <script src="./fractory_files/point.js"></script>
        <script src="./fractory_files/trig.js"></script>

        <script src="./fractory_files/tooltips.js"></script>
        <script src="./fractory_files/controller.js"></script>
        <script src="./fractory_files/utils.js"></script>
        <script src="./fractory_files/rand.js"></script>

        <script src="./fractory_files/roman.js"></script>
        <script src="./fractory_files/analytics.js(1)"></script>

        <script src="./fractory_files/manacolors.js"></script>
        <script src="./fractory_files/ko_bindings.js"></script>
        <script src="./fractory_files/inventoryslot.js"></script>
        <script src="./fractory_files/shop_slot.js"></script>
        <script src="./fractory_files/trash_slot.js"></script>
        <script src="./fractory_files/node.js"></script>
        <script src="./fractory_files/shell.js"></script>
        <script src="./fractory_files/link.js"></script>
        <script src="./fractory_files/part.js"></script>
        <script src="./fractory_files/junction.js"></script>
        <script src="./fractory_files/junctionanim.js"></script>
        <script src="./fractory_files/mechs.js"></script>
        <script src="./fractory_files/research.js"></script>
        <script src="./fractory_files/talent.js"></script>
        <script src="./fractory_files/upgrade.js"></script>
        <script src="./fractory_files/boost.js"></script>
        <script src="./fractory_files/main.js"></script>
        <script src="./fractory_files/mousetrap.min.js"></script>
        <script src="./fractory_files/keybinds.js"></script>

        <script type="text/html" id="kot/game.html" src="./fractory_files/game.html">&nbsp;
            <button data-bind="
                visible: game.shell() && !!game.view_shell().in_part() && !game.view_shell().zoom_out(),
                click: _.bind(game.zoom_out, game)
                ">Zoom Out</button>


            <div class="part_sandbox">

                <div class="inventory_holder">
                        <div class="inventory_label">Held</div>
                <!-- ko foreach: {
                        data: game.inventory_slots(),
                        as: 'islot'
                } -->
                        <!-- ko template: {
                                name: 'kot/inventory_slot.html',
                                data: islot,
                                as: 'islot',
                        } --><!-- /ko -->

                <!-- /ko -->
                        <div class="clear trash_label">Trash</div>
                <!-- ko template: {
                        name: 'kot/trash_slot.html',
                        data: game,
                        as: 'game'
                } --><!-- /ko -->
                </div>

                <div class="shell_holder" data-bind="css: game.paused() ? 'paused' : ''">
                <!-- ko if: game.shell() -->

                        <!-- ko foreach: {data: game.shell_renders(), as: 'shell' } -->
                        <div class="shell" data-bind="
                                style: {
                                        width: shell.elsize.x,
                                        height: shell.elsize.y,
                                },
                                shell_render: shell,
                                right_click: _.bind(shell.right_click, shell),

                        ">

                                <div class="nodes">
                                        <!-- ko foreach: {data: _.values(shell.nodes), as: 'node'} -->
                                                <div class="node" data-bind="
                                                        css: 'node_' + node.loc,
                                                        style: {
                                                                width: node.elsize.x,
                                                                height: node.elsize.y,
                                                                left: node.pos.x,
                                                                top: node.pos.y,
                                                        },
                                                        dropzone: {
                                                                ondropenter: function(ev) {
                                                                        console.log('ondropenter', ev);
                                                                        ev.draggable.dropped_on = node;
                                                                },
                                                                ondropleave: function(ev) {
                                                                        console.log('ondropleave', ev);
                                                                        ev.draggable.dropped_on = null;
                                                                },

                                                                ondrop: function(ev) {
                                                                        console.log('ondrop', ev);
                                                                        if(game.animating_shell()) return;

                                                                        node.set_part(ev.draggable.dragObject);
                                                                },
                                                                overlap: 'center'
                                                        },
                                                        double_tap: _.bind(node.double_tap, node),
                                                        right_click: _.bind(node.right_click, node),
                                                        event: {
                                                                mouseover: function(node, event) {
                                                                        game.hovered_node(node);
                                                                },
                                                                mouseout: function(node, event) {
                                                                        if(game.hovered_node() !== node) return;
                                                                        game.hovered_node(null);
                                                                }
                                                        }
                                                ">
                                                        <div class="node_raph" data-bind="
                                                                raphael: _.bind(node.raph, node)
                                                        ">
                                                        </div>
                                                        <!-- ko if: node.part() -->
                                                                <!-- ko with: {part: node.part(), shell: node.shell } -->
                                                                        <!-- ko template: {
                                                                                name: 'kot/part.html',
                                                                                data: part,
                                                                                as: 'part',
                                                                                shell: node.shell,
                                                                        } --> <!-- /ko -->
                                                                <!-- /ko -->
                                                        <!-- /ko -->
                                                </div>
                                        <!-- /ko -->
                                </div>
                                <div class="links">
                                <!-- ko foreach: {
                                        data: _.values(shell.nodes), as: 'node'
                                } -->
                                <!-- ko foreach: {
                                        data: _.filter(node.links, function(link) {
                                                return link.primary();
                                                return link.flow() === 'down' || (link.flow() !== 'up' && link.primary()) || !link.pair_link();
                                        }),
                                        as: 'link'
                                } -->
                                        <div class="link" data-bind="
                                                style: {
                                                        width: link.elsize.x,
                                                        height: link.elsize.y,
                                                        left: link.pos.x,
                                                        top: link.pos.y,
                                                        transform: link.rotate_transform
                                                },
                                                css: (function() {
                                                        var classes = link.flow();
                                                        classes += ' dir_' + link.direction();
                                                        if(link.active()) classes += ' active';
                                                        return classes;
                                                })(),
                                                click: _.bind(link.click, link),
                                                event:{
                                                    mouseover: function(link,event) {
                                                        if(event.shiftKey) {
                                                            link.set_active(true);
                                                        }
                                                        else if(event.ctrlKey){
                                                            link.set_active(false);
                                                        }
                                                    },
                                                    mouseenter: function(link,event) {
                                                        if(event.shiftKey) {
                                                            link.set_active(true);
                                                        }
                                                        else if(event.ctrlKey){
                                                            link.set_active(false);
                                                        }
                                                    },
                                                }
                                        ">

                                                <div class="stripe_holder" data-bind="

                                                        css: link.stripe_holder_css()
                                                ">
                                                        <div class="inner_stripe_holder">
                                                                <div class="link_stripe"></div>
                                                                <div class="link_stripe"></div>
                                                                <div class="link_stripe"></div>
                                                        </div>
                                                </div>
                                                <!-- ko if: false -->
                                                <div class="flow_arrow" data-bind="
                                                        text: !link.active() ? '' :
                                                                  link.flow_direction() === link.direction() ? '--->' :
                                                              link.flow_direction() === null ? '|' :
                                                              '<---'
                                                "></div>
                                                <!-- /ko -->
                                                <span data-bind="visible: false, text: link.node().loc + '->' + (link.pair_link() ? link.pair_link().node().loc : '') + (link.active() ? link.flow() : '')"></span>
                                        </div>

                                <!-- /ko -->
                                <!-- /ko -->
                                </div>

                        </div>
                        <!-- /ko -->
                        <!-- /ko -->
                </div>
                <!-- ko template: {
                        name: 'kot/shop_bar.html',
                        data: game,
                        as: 'game'
                } --><!-- /ko -->
                <div class="clear"></div>
                <div class="status_bar">
                        <!-- ko template: { name: 'kot/status_bar.html', data: game, as: 'game' } --><!-- /ko -->
                </div>
                <div class="panes">
                        <div class="pane_chooser">
                                <!-- ko foreach: {
                                        data: [
                                                {'pane' : 'stats', label: 'Reflect'},
                                                {pane: 'upgrades', label: 'Enchant'},
                                                {pane: 'talents', label: 'Ascend'},

                                        ],
                                        as: 'pb'
                                } -->
                                        <a class="pane_button" data-bind="
                                                css: game.current_pane() === pb.pane ? 'active' : '',
                                                click: function() { game.current_pane(pb.pane); }
                                        ">
                                                <span data-bind="text: pb.label"></span>
                                                <!-- ko if: pb.pane === 'talents' && game.level_after_ascend() - game.level() > 0 -->
                                                (<span data-bind="text: game.level_after_ascend() - game.level()"></span>)
                                                <!-- /ko -->

                                        </a>
                                <!-- /ko -->
                                <a class="pane_button" data-bind="
                                        click: function() { game.save_game(); }
                                ">
                                        <span data-bind="text: 'Saved ' + game.save_ticks() + ' secs ago'"></span>
                                </a>

                                <a class="pane_button" data-bind="
                                        click: function() { game.paused() ? game.unpause() : game.pause(); }
                                ">
                                        <span data-bind="text: game.paused() ? 'Paused' : 'Pause'"></span>
                                </a>

                                <a class="pane_button" data-bind="
                                        click: function() { alert(game.controls_help_message()); }
                                ">
                                        <span data-bind="text: 'Controls'"></span>
                                </a>


                        </div>
                        <!-- ko template: { name: 'kot/panes/stats_pane.html', data: game, as: 'game' } --><!-- /ko -->
                        <!-- ko template: { name: 'kot/panes/shop_pane.html', data: game, as: 'game' } --><!-- /ko -->
                        <!-- ko template: { name: 'kot/panes/research_pane.html', data: game, as: 'game' } --><!-- /ko -->
                        <!-- ko template: { name: 'kot/panes/upgrades_pane.html', data: game, as: 'game' } --><!-- /ko -->
                        <!-- ko template: { name: 'kot/panes/talents_pane.html', data: game, as: 'game' } --><!-- /ko -->


                </div>
            </div>
        </script>
        <script type="text/html" id="kot/part.html" src="./fractory_files/part.html">
            <div class="part" data-bind="
                draggable: {
                        dragObject: part,
                        restrict: {
                                restriction: '.part_sandbox'
                        },
                        onstart: function(ev) {
                                /* Actually I already know where it needs to go.. */
                                ev.target.setAttribute('data-x', 0);
                                ev.target.setAttribute('data-y', 0);
                                ev.target.style.transition = '';
                                game.dragging_part(part);

                        },
                        onend: function(ev) {
                                        ev.target.style.transition = 'transform 0.25s';
                                        ev.target.style.transform = '';
                                        game.dragging_part(null);
                        },
                        onmove: function(event) {
                                var target = event.target,
                                // keep the dragged position in the data-x/data-y attributes
                                x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
                                y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

                            // translate the element
                            target.style.webkitTransform =
                            target.style.transform =
                              'translate(' + x + 'px, ' + y + 'px)';

                            // update the posiion attributes
                            target.setAttribute('data-x', x);
                            target.setAttribute('data-y', y);
                        },
                        snap: {

                        }
                },
                right_click: _.bind(part.double_tap, part),
                double_tap: _.bind(part.double_tap, part),
                tap: _.bind(part.tap, part),
                event: {
                    mouseover: function(part, event) {
                            game.hovered_part(part);
                    },
                    mouseout: function(part, event) {
                            if(game.hovered_part() !== part) return;
                            game.hovered_part(null);
                    },
                },
                qtip_template: {
                        name: 'kot/part_tooltip.html',
                        data: part,
                        as: 'part',
                        qtip: {
                                'show': {
                                        'effect': false,
                                },
                                'title': 'title1',
                                'content': {
                                        'title': part.name(),
                                        'text': 'foo',
                                },
                                'style': {
                                        'classes': 'qtip-dark'
                                },
                                'hide': {
                                        'fixed': false,
                                        'effect': false,
                                },
                                'position': {
                                        'my': 'top right',
                                        'at': 'top left',
                                        viewport: $(window),
                                        target: 'mouse',
                                        adjust: {
                                            screen: true,
                                            method: 'flip',
                                        },
                                }
                        }
                }
                ">
                <div class="part_raph" data-bind="
                        raphael: _.bind(part.raph, part)
                ">
                        <div class="glyph_holder" data-bind="css: part.glyph_holder_css()">
                                <span class="glyph glyph1 magi" data-bind="css: part.glyph_classes()[0]"></span>
                                <span class="glyph glyph2 magi" data-bind="css: part.glyph_classes()[1]"></span>
                                <span class="glyph glyph3 magi" data-bind="css: part.glyph_classes()[2]"></span>

                        </div>
                </div>
            </div>
        </script>
        <script type="text/html" id="kot/inventory_slot.html" src="./fractory_files/inventory_slot.html" ><div class="inventory_slot" data-bind="
                    dropzone: {
                        ondropenter: function(ev) {
                            console.log('ondropenter', ev);
                            ev.draggable.dropped_on = islot;
                        },
                        ondropleave: function(ev) {
                            console.log('ondropleave', ev);
                            ev.draggable.dropped_on = null;
                        },

                        ondrop: function(ev) {
                            console.log('ondrop', ev);
                            if(game.animating_shell()) return;

                            islot.set_part(ev.draggable.dragObject);
                        },
                        overlap: 'center'
                    },
                    event: {
                    mouseover: function(slot, event) {
                            game.hovered_inventory_slot(slot);
                    },
                    mouseout: function(slot, event) {
                            if(game.hovered_inventory_slot() !== slot) return;
                            game.hovered_inventory_slot(null);
                    },
                },
                ">
                    <!-- ko if: islot.part() -->
                                <!-- ko with: {part: islot.part(), shell: islot.shell } -->
                                    <!-- ko template: {
                                        name: 'kot/part.html',
                                        data: part,
                                        as: 'part',
                                        shell: islot.shell,
                                    } -->
                                    <!-- /ko -->
                                <!-- /ko -->
                            <!-- /ko -->
                </div>
        </script>
        <script type="text/html" id="kot/trash_slot.html" src="./fractory_files/trash_slot.html" ><div class="trash_slot" data-bind="
                    dropzone: {
                        ondropenter: function(ev) {
                            console.log('ondropenter', ev);
                            ev.draggable.dropped_on = game.trash_slot();
                        },
                        ondropleave: function(ev) {
                            console.log('ondropleave', ev);
                            ev.draggable.dropped_on = null;
                        },

                        ondrop: function(ev) {
                            console.log('ondrop', ev);
                            if(game.animating_shell()) return;

                            game.trash_slot().set_part(ev.draggable.dragObject);
                        },
                        overlap: 'center'
                    }
                ">
            </div>
        </script>
        <script type="text/html" id="kot/part_tooltip.html" src="./fractory_files/part_tooltip.html" ><div>
            <table class="stat_table">
                <tbody>
                <!-- ko if: Ice.isa(part, CorePart) -->
                <tr class="stat_row">
                        <td class="stat_noun">Core</td>
                        <td class="total">

                        </td>
                        <td class="description">The core of your Fractory.  Cannot be moved.  All crystals must be linked to it to function.</td>
                </tr>
                <!-- /ko -->
                <!-- ko if: Ice.isa(part, FractalPart) -->
                <tr class="stat_row">
                        <td class="stat_noun">Fractal</td>
                        <td class="total">

                        </td>
                        <td class="description">A fractally nested spatial anomaly.  Can hold more crystals inside.  Links from the outside correspond to links inside; cannot be directly linked to.  The maximum depth on which it can be placed depends on tier.</td>
                </tr>
                <!-- /ko -->
                <!-- ko if: Ice.isa(part, ConduitPart) -->
                <tr class="stat_row">
                        <td class="stat_noun">Conduit</td>
                        <td class="total">

                        </td>
                        <td class="description">Each tick, after all other actions, moves an immediately upstream crystal to the next empty downstream node.  Blocks other crystals from moving crystals past it.</td>
                </tr>
                <!-- /ko -->
                <!-- ko if: Ice.isa(part, CapacitorPart) -->
                <tr class="stat_row">
                        <td class="stat_noun">Capacitor</td>
                        <td class="total">

                        </td>
                        <td class="description">Each tick, after all other actions, moves an immediately upstream crystal to the next empty downstream node, IF it was not improved this tick.  Blocks other crystals from moving crystals past it.</td>
                </tr>
                <!-- /ko -->
                <!-- ko if: Ice.isa(part, HopperPart) -->
                <tr class="stat_row">
                        <td class="stat_noun">Hopper</td>
                        <td class="total">

                        </td>
                        <td class="description">Each tick, after all other actions, moves an immediately upstream crystal to the next empty inventory slot, IF it was not improved this tick.  Then, moves the first crystal in your inventory to the next empty downstream node.  Blocks other crystals from moving crystals past it, and never moves other blocks.</td>
                </tr>
                <!-- /ko -->
                <!-- ko if: Ice.isa(part, RelayPart) -->
                <tr class="stat_row">
                        <td class="stat_noun">Relay</td>
                        <td class="total">

                        </td>
                        <td class="description">Passes effects from upstream directly downstream.  Passes through empty crystals and other relays, but cannot fork.</td>
                </tr>
                <!-- /ko -->
                <!-- ko if: Ice.isa(part, BlankGeneratorPart) -->
                <tr class="stat_row">
                        <td class="stat_noun">Blank Generator</td>
                        <td class="total">

                        </td>
                        <td class="description">Generates blank crystals in immediately downstream nodes.</td>
                </tr>
                <!-- /ko -->
                <tr class="stat_row">
                        <td class="stat_noun">Tier</td>
                        <td class="total">
                                <span class="value" data-bind="text: part.tier()"></span>
                        </td>
                        <td class="description">
                                Determines maximum refinement.
                        </td>
                </tr>



                <!-- ko foreach: {
                    data: _.sortBy(part.stats_list(), function(part) {
                                return part.total() * -1;
                        }),
                        as: 'sv'
                } -->
                <tr class="stat_row">
                        <td class="stat_noun" data-bind="text: sv.mech().props().noun"></td>
                        <td class="total">
                                <span class="value" data-bind="text: sv.value().formatBig()"></span>
                                <span class="buff" data-bind="visible: sv.buff(), text: '+' + sv.buff().formatBig()"></span>
                        </td>
                        <td class="description">
                                <!-- ko if: sv.code() === 'Flaw' -->
                                        Does nothing.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Glow' -->
                                        Generates <span class="factor" data-bind="text: sv.factor().formatBig()"></span> mana  per tick. (<span class="factor" data-bind="text: (sv.factor() * part.stat_factor('Brilliance') * part.stat_factor('Vividity')).formatBig()"></span>)
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Brilliance' -->
                                        Increases mana generation by <span class="factor" data-bind="text: sv.factor().formatByPercent()"></span>.  Requires Glow on the same crystal to be effective.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Vividity' -->
                                        Increases mana and arcana generation by <span class="factor" data-bind="text: sv.factor().formatByPercent()"></span>.  Requires Glow and/or Arcana on the same crystal to be effective.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'GenerationFlatModifier' -->
                                        Increases mana generation by <span class="factor" data-bind="text: sv.factor()"></span> per tick.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Radiance' -->
                                        Buffs <span class="factor" data-bind="text: sv.factor().formatByPercent() "></span> of all other stats on this crystal to immediately downstream crystals.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Conductivity' -->
                                        Permanently transfers <span class="factor" data-bind="text: sv.factor()"></span>/tick of the lowest stat on immediately upstream crystals to immediately downstream crystals.  Effect splits if there's multiple valid targets.  Costs mana while connected.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Waxing' -->
                                        Permanently increases the highest stat on immediately downstream crystals by <span class="factor" data-bind="text: sv.factor()"></span>/tick.  Costs mana while connected.  Mana cost scales with target crystal tier.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Reflection' -->
                                        Permanently increases a stat on a single immediately downstream crystal by <span class="factor" data-bind="text: sv.factor()"></span>/tick.  The stat chosen is the highest stat on a single immediately upstream crystal, and the downstream part won't exceed the upstream part's value in that stat.  Costs mana while connected.  Mana cost scales with downstream crystal tier.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Arcana' -->
                                        Converts mana to arcana, which is spent on Enchanting.  Enchanting increases the effective value of all stats on all crystals.  (<span class="factor" data-bind="text: (sv.factor() * part.stat_factor('Mystery') * part.stat_factor('Vividity')).formatBig()"></span>/tick after buffs).
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Mystery' -->
                                        Increases arcana by <span class="factor" data-bind="text: sv.factor().toFixed(2)"></span>x.  Requires Arcana on the same crystal to be effective.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Imbuing' -->
                                        Permanently increases maximum refinement on immediately downstream crystals by <span class="factor" data-bind="text: sv.factor()"></span>/tick, up to 2x the normal value.  Costs mana while connected.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Infusing' -->
                                        Infuses immediately downstream crystals with mana at <span class="factor" data-bind="text: sv.factor()"></span>/tick.  Infusion does not count towards refinement.  At great levels of infusion, a crystal's tier increases, dramatically increasing maximum refinement.  <strong>Can only infuse crystals of equal or lesser tier.</strong>
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Infused' -->
                                        Does not count toward refinement.  At <span class="factor" data-bind="text: (10 * Math.pow(1000, part.tier())).formatBig()"></span>, tier increases by one permanenty, dramatically increasing maximum refinement.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Luster' -->
                                        Maximum refinement increased by <span class="factor" data-bind="text: sv.factor()"></span>.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Power' -->
                                        All other stats on this crystal buffed by <span class="factor" data-bind="text: sv.factor().formatByPercent()"></span>.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Shine' -->
                                        Buffs all stats on immediately downstream crystals by <span class="factor" data-bind="text: sv.factor().formatByPercent()"></span>, except Shine.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Lens' -->
                                        Buffs this crystal's stats by <span class="factor" data-bind="text: sv.factor().formatPercentOf()"></span> of each stat of each immediately upstream part, excluding Lens.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Prism' -->
                                        Grants <span class="factor" data-bind="text: sv.factor().formatPercentOf()"></span> of each stat of a single immediately upstream crystal as a buff to each immediately downstream part, excluding Prism.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Shimmer' -->
                                        Increases all other stats of this crystal by <span class="factor" data-bind="text: sv.factor().formatByPercent()"></span> for each stat (additively) other than Shimmer on this crystal.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Seal' -->
                                        Increases all other stats of this crystal by <span class="factor" data-bind="text: sv.factor().formatByPercent()"></span> if there are no immediately downstream crystals.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Resonance' -->
                                        Permanently increases Flux on immediately downstream crystals by <span class="factor" data-bind="text: sv.factor()"></span>/tick.  When a downstream crystal's Flux exceeds the single immediately upstream crystal's total base stats, the Flux is converted into the upstream crystal's base stats.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Flux' -->
                                        A placeholder stat that can be turned into real stats by Resonance.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Purity' -->
                                        Increases the highest stat on this crystal by <span class="factor" data-bind="text: sv.factor().formatByPercent()"></span>, if it is at least 50% of the total base stats on this crystal.
                                <!-- /ko -->
                                <!-- ko if: sv.code() === 'Gleam' -->
                                        Increases all other stats of this crystal by <span class="factor" data-bind="text: sv.factor().formatByPercent()"></span> for each step away this crystal is from the core.
                                <!-- /ko -->



                        </td>

                </tr>
                <!-- /ko -->

                <tr class="stat_row">
                        <td class="stat_noun" data-bind="text: Ice.isa(part.container(), ShopSlot) ? 'Price' : 'Value'"></td>
                        <td class="total">
                                <span class="value" data-bind="text: part.mana_cost().formatBig()"></span>
                        </td>
                </tr>
                <!-- ko if: !Ice.isa(part, CorePart) && !Ice.isa(part, FractalPart) && !Ice.isa(part, ConduitPart) && part.max_refinement() -->
                <tr class="stat_row">
                        <td class="stat_noun">Refinement</td>
                        <td colspan="2">
                                <div class="progressbar_with_overlay refinement_bar">
                                        <div class="progressbar" data-bind="
                                                progressbar: {
                                                        part:part,
                                                        value: part.refinement,
                                                        max: part.max_refinement
                                                }
                                        ">
                                        </div>
                                        <div class="overlay">
                                                <span data-bind="text: part.refinement().formatBig()"></span> /
                                                <span data-bind="text: part.max_refinement().formatBig()"></span>
                                        </div>
                                </div>
                        </td>
                </tr>

                <!-- /ko -->


                <!-- ko if: part.stats().Infused -->
                        <tr class="stat_row">
                                <td class="stat_noun">Infusion</td>
                                <td colspan="2">
                                        <div class="progressbar_with_overlay infusion_bar">
                                                <div class="progressbar" data-bind="
                                                        progressbar: {
                                                                part:part,
                                                                value: ko.computed(function() {
                                                                        return !(part.stats().Infused) ? 0 : part.stats().Infused.value2();
                                                                }),
                                                                max: ko.computed(function() { return part.next_tier_at(); })
                                                        }
                                                ">
                                                </div>
                                                        <div class="overlay">
                                                                <span data-bind="text: part.stats().Infused.value().formatBig()"></span> /
                                                                <span data-bind="text: part.next_tier_at().formatBig()"></span>
                                                        </div>
                                        </div>
                                </td>
                        </tr>



                <!-- /ko -->
                </tbody>
            </table>
        </div>
        </script>
        <script type="text/html" id="kot/panes/stats_pane.html" src="./fractory_files/stats_pane.html" ><div class="pane game_stats" data-bind="visible: game.current_pane() === 'stats'">
            <table class="game_stats">
                <tbody>
                    <tr>
                        <th>Experience</th>
                        <td>
                            <span data-bind="text: game.experience().formatBig()"></span>
                        </td>
                    </tr>
                    <tr>
                        <th>Arcana</th>
                        <td>
                            <span data-bind="text: game.arcana().formatBig()"></span> (Arcana spent on Enchanting becomes exp)
                        </td>
                    </tr>
                    <tr>
                        <th>Level after ascent</th>
                        <td>

                            <span data-bind="text: game.level_after_ascend()"></span>
                        </td>
                    </tr>
                    <tr>
                        <th>Next Level At</th>
                        <td>
                            <span data-bind="text: (game.exp_for_level(game.level_after_ascend() + 1) - game.experience()).formatBig()"></span> Arcana
                            (<span data-bind="text: (game.exp_for_level(game.level_after_ascend() + 1) - game.experience() - game.arcana_spent()).formatBig()"></span> more)
                        </td>
                    </tr>

                    <tr>
                        <td>Mana:</td>
                        <td data-bind="text: game.mana().formatBig()"></td>
                    </tr>
                    <tr>
                        <td>Generated/tick:</td>
                        <td>
                            +<span data-bind="text: game.mana_generated().formatBig()"></span>
                        </td>
                    </tr>
                    <!-- ko foreach: {
                        data: _.sortBy(game.spent_mana(), function(sm) {
                            return -1 * sm.val();
                        }),
                        as: 'sm'
                        }
                    -->
                        <tr>
                            <td>
                                <span data-bind="text: sm.reason"></span>:
                            </td>
                            <td data-bind="text: (-1 * sm.val()).formatBig()"></td>
                        </tr>
                    <!-- /ko -->
                    <tr>
                        <td>Net</td>
                        <td data-bind="
                            text: (game.net_mana() < 0 ? '' : '+') + game.net_mana().formatBig()
                        "></td>
                    </tr>
                </tbody>
            </table>
            <!-- ko if: game.focused_part() -->
                <div class="info_part">
                    <div data-bind="text: game.focused_part().name()"></div>
                    <div class="part_tooltip">
                        <!-- ko template: {
                            name: 'kot/part_tooltip.html',
                            data: game.focused_part(),
                            as: 'part'
                        } --> <!-- /ko -->

                    </div>
                </div>
            <!-- /ko -->
        </div>
        </script>
        <script type="text/html" id="kot/panes/shop_pane.html" src="./fractory_files/shop_pane.html" >
        <div class="pane shop" data-bind="visible: game.current_pane() === 'shop'">
            &nbsp;
            <div class="shop_slot_holder">
            &nbsp;
            <!-- ko if: game.chosen_shop_slot() -->
                <!-- ko with: {ss: game.chosen_shop_slot()} -->
                    <div class="shop_slot">
                    <!-- ko if: ss.part() -->
                        <!-- ko with: {ss: ss, part: ss.part(), shell: ss.shell } -->
                            <!-- ko template: {
                                    name: 'kot/part.html',
                                    data: part,
                                    as: 'part',
                                    shell: ss.shell,
                            } --><!-- /ko -->
                        <!-- /ko -->
                    <!-- /ko -->
                    </div>
                <!-- /ko -->
            <!-- /ko -->
            </div>
            <div class="shop_settings">
                <table>
                    <tbody>

                        <tr>
                            <th>Type</th>
                            <td>
                            <!-- ko foreach: {
                                data: game.shop_slots(),
                                as: 'ss'
                            } -->
                                <a class="shop_choose_button" data-bind="
                                    text: {
                                        'blank': 'Blank',
                                        'single': 'Simple',
                                        'multi': 'Complex',
                                        'fractal': 'Fractal',
                                        'conduit': 'Conduit',
                                    }[ss.mode()],
                                    css: game.chosen_shop_slot() === ss ? 'active' : '',
                                    click: function() {game.chosen_shop_slot(ss); }
                                ">
                                </a>
                            <!-- /ko -->
                            </td>
                        </tr>
                        <!-- ko if: game.chosen_shop_slot() --><!-- ko with: {ss: game.chosen_shop_slot()} -->
                        <tr>
                            <th>Tier</th>
                            <td>
                                <div class="tier_selector">
                                    <button class="tier_down" data-bind="
                                        disable: ss.tier() <= 1,
                                        click: function() {
                                            ss.tier.inc(-1);
                                            ss.restock();
                                        }
                                    ">-</button>
                                    <span class="tier" data-bind="text: ss.tier()"></span>
                                    <button class="tier_up" data-bind="
                                        disable: ss.tier() >= ss.max_tier(),
                                        click: function() {
                                            ss.tier.inc(1);
                                            ss.restock();
                                        }
                                    ">+</button>

                                </div>

                            </td>
                        </tr>
                        <!-- ko if: ss.part() -->
                        <tr>
                            <th>Reroll</th>
                            <td>
                                <a class="action_button reroll" data-bind="
                                    click: function() {ss.restock();},
                                ">
                                    Reroll
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <th>Preview</th>
                            <td>
                                <div class="part_tooltip">
                                <!-- ko template: {
                                    name: 'kot/part_tooltip.html',
                                    data: ss.part(),
                                    as: 'part'
                                } --> <!-- /ko -->

                                </div>
                            </td>
                        </tr>
                        <!-- /ko -->
                        <!-- /ko --><!-- /ko -->
                    </tbody>
                </table>
            </div>
            <div class="clear"></div>
        </div>
        </script>
        <script type="text/html" id="kot/panes/research_pane.html" src="./fractory_files/research_pane.html" ><div class="pane research" data-bind="visible: game.current_pane() === 'research'">
            <table>
                <thead>
                    <th>Name</th>
                    <th>Arcana</th>
                    <th>Mana</th>
                    <th>Description</th>
                </thead>
                <tbody>
            <!-- ko foreach: {
                data: _.values(game.available_research()).concat(_.values(game.learned_research())),
                as: 'r'
            } -->

                <tr class="available_research" data-bind="
                    click: function() {
                        game.buy_research(r);
                    },
                    css: r.css(game),
                ">
                    <td class="name" data-bind="text: r.name"></td>
                    <td class="arcana" data-bind="text: r.arcana_requirement()"></td>
                    <td class="mana_cost" data-bind="text: r.mana_cost()"></td>
                    <td class="description" data-bind="text: r.description()"></td>


                </tr>
            <!-- /ko -->
                </tbody>
            </table>
        </div>
        </script>
        <script type="text/html" id="kot/panes/upgrades_pane.html" src="./fractory_files/upgrades_pane.html" ><div class="pane upgrades" data-bind="visible: game.current_pane() === 'upgrades'">
            <p>
                Spend Arcana to increase the effective value of a stat on all crystals.
            </p>
            <table class="shop_table noselect">
                <thead>
                    <th>Name</th>
                    <th>Level</th>
                    <th>Bonus</th>
                    <th>Next Cost</th>
                    <th>Next Bonus</th>
                    <th>Description</th>
                </thead>
                <tbody>
            <!-- ko foreach: {
                data: _.chain(game.upgrades_list()).filter(function(ug) { return ug.available(game); }).value(),
                as: 'ug'
            } -->

                <tr class="upgrade available_upgrade" data-bind="
                    click: function(data, ev) {
                        if(ev.mouseButton != 2)
                            game.buy_upgrade(ug);
                    },
                    right_click: function(ev) {

                        game.unbuy_upgrade(ug);

                    },
                    css: ug.css(game),
                ">
                    <td class="name" data-bind="text: ug.name()"></td>
                    <td class="points">
                        <span data-bind="text: ug.points()"></span>
                        <!-- ko if: ug.max_points(game) !== Infinity -->
                        / <span data-bind="text: ug.max_points(game)"></span>
                        <!-- /ko -->
                    </td>
                    <td class="current_factor" data-bind="text: ug.boost_factor().formatByPercent()"></td>
                    <td class="arcana_cost" data-bind="text: ug.arcana_cost().formatBig()"></td>
                    <td class="next_increase" data-bind="
                        text: (ug.boost_factor(ug.points() + 1) - ug.boost_factor() + 1).formatByPercent()
                    "></td>
                    <td class="description">
                        Boosts the effective value of <span data-bind="text: ug.mech().props().noun"></span>.
                    </td>
                </tr>
            <!-- /ko -->
                </tbody>
            </table>
        </div>
        </script>
        <script type="text/html" id="kot/panes/talents_pane.html" src="./fractory_files/talents_pane.html" ><div class="pane talents" data-bind="visible: game.current_pane() === 'talents'">

            <div class="ascend_block">
                <p>
                    <button data-bind="
                        click: function() {
                            var conf = window.confirm('Ascending will destroy all crystals and upgrades, granting experience equal to your spent arcana.  Are you sure?  (Protip: your first ascent should be to level 3.)');
                            if(conf) game.ascend();
                        }
                    ">Ascend</button> now for
                    <span data-bind="text: game.arcana_spent().formatBig()"></span> experience, increasing level by
                    <span data-bind="text: game.level_after_ascend() - game.level()"></span>.
                </p>
                <p>
                    You gain experience by enchanting, one point per arcana spent.
                </p>
                <p>
                    <strong style="color: red;">You will LOSE ALL CRYSTALS AND UPGRADES when you ascend.</strong>
                </p>
            </div>

            <table class="stats_table horiz_stats">
                <thead>
                    <tr>
                        <th>Level</th>
                        <th>Available Talent Points</th>
                        <th>Next Level At</th>
                        <th>Next Discovery</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-bind="text: game.level()"></td>
                        <td>
                            <span data-bind="text: game.unspent_tp()"></span>
                            / <span data-bind="text: game.total_tp()"></span>
                        <td>
                            <span data-bind="text: (game.exp_for_level(game.level_after_ascend() + 1) - game.experience()).formatBig()"></span> Arcana
                            (<span data-bind="text: (game.exp_for_level(game.level_after_ascend() + 1) - game.experience() - game.arcana_spent()).formatBig()"></span> more)
                        </td>

                        <td>
                            <!-- ko if: !game.next_talent_discovered() -->
                                None
                            <!-- /ko -->
                            <!-- ko if: game.next_talent_discovered() -->
                                <span data-bind="text: game.next_talent_discovered().name()"></span>
                                at Level <span data-bind="text: game.next_talent_discovered().min_level()"></span>
                            <!-- /ko -->

                        </td>

                    </tr>
                </tbody>

            </table>
            <div class="reset_block">
                <p>
                    <button data-bind="
                        click: function() {
                            var conf = window.confirm('You can reset your spent talent points, but it will force an ascension at the same time.  Are you sure?');
                            if(!conf) return;
                            _.each(game.talents_list(), function(tal) { tal.points(0); });
                            game.ascend();
                        }
                    ">Reset Points</button> (requires immediate ascent)
                </p>
            </div>

            <table class="shop_table">
                <thead>
                    <th>Name</th>
                    <th>Level</th>
                    <th>Bonus</th>
                    <th>Description</th>
                </thead>
                <tbody>
            <!-- ko foreach: {
                data: _.chain(game.talents_list()).filter(function(tal) { return tal.available(game); }).value(),
                as: 'tal'
            } -->

                <tr class="available_talent" data-bind="
                    click: function() {
                        game.buy_talent(tal);
                    },
                    css: tal.css(game),
                ">
                    <td class="name" data-bind="text: tal.name()"></td>
                    <td class="points">
                        <span data-bind="text: tal.points()"></span>
                        <!-- ko if: tal.max_points(game) !== Infinity -->
                        / <span data-bind="text: tal.max_points(game)"></span>
                        <!-- /ko -->
                    </td>
                    <td class="current_factor">
                        <!-- ko if: tal.boost_mech_code() && tal.points() -->
                            <span data-bind="text: tal.boost_factor().formatByPercent()"></span>
                        <!-- /ko -->
                    </td>
                    <td class="description">
                        <!-- ko if: tal.unlocks_stat() && (tal.boost_mech_code() !== tal.unlocks_stat() || tal.points() == 0) -->
                        <span class="line">Unlocks the <span data-bind="text: Mechs[tal.unlocks_stat()].props().noun"></span> stat.</span>

                        <!-- /ko -->

                        <!-- ko if: tal.boost_mech_code() && (tal.unlocks_stat() != tal.boost_mech_code() || tal.points() > 0) -->
                        <span class="line">
                            <span data-bind="if: tal.boost_mech_code() === tal.unlocks_stat() && false">Unlocks/</span>Boosts
                            the <span data-bind="text: Mechs[tal.boost_mech_code()].props().noun"></span> stat.</span>
                        <!-- /ko -->
                        <!-- ko if: tal.adds_inventory_slots() -->
                        <span class="line">Adds 3 inventory slots.</span>
                        <!-- /ko -->
                        <!-- ko if: tal.shop_mode() -->
                            <span class="line">
                                <span data-bind="
                                    text: {
                                        'single': 'Increases the maximum tier of Simple crystal you can conjure.',
                                        'multi': 'Increases the maximum tier of Complex crystal you can conjure.',
                                        'fractal': 'Increases the maximum tier of Fractal crystal you can conjure.  Higher tiers can be nested deeper.',
                                        'conduit': 'Unlocks conduits, which automatically move parts downstream.',
                                        'capacitor': 'Unlocks capacitors, which automatically move parts downstream when they\'re done improving.',
                                        'relay': 'Unlocks relays, which redirect effects further downstream.',
                                        'hopper': 'Unlocks hoppers, which move crystals in and out of your inventory.',
                                        'blank': 'Increases the maximum tier of Blank crystal you can conjure.',
                                        'blank_generator': 'Increases the maximum tier of Blank Generator you can conjure. Higher tiers generate higher tier blanks. Requires points in Better Blanks.'
                                    }[tal.shop_mode()]"></span>

                            </span>
                        <!-- /ko -->
                    </td>
                </tr>
            <!-- /ko -->
                </tbody>
            </table>
            <div class="full_reset">
                <button data-bind="click: _.bind(game.full_reset, game)">Full Reset</button> to lose all crystals, upgrades, AND EXPERIENCE, LEVELS, AND TALENTS.  This is a complete reset!  There is no going back!
            </div>
        </div>
        </script>
        <script type="text/html" id="kot/shop_bar.html" src="./fractory_files/shop_bar.html" >    <div class="shop_bar">
                <div class="shop_label">Conjure</div>

                <div class="shop_slot_holder">
                    <!-- ko foreach: {
                        data: game.shop_slots(),
                        as: 'ss'
                    } -->
                        <div class="shop_entry">
                            <div class="shop_slot_label" data-bind="
                                text: {
                                    'blank': 'Blank',
                                    'single': 'Simple',
                                    'multi': 'Complex',
                                    'fractal': 'Fractal',
                                    'conduit': 'Conduit',
                                    'capacitor': 'Capacitor',
                                    'relay': 'Relay',
                                    'hopper': 'Hopper',
                                    'blank_generator': 'Blank Generator',
                                }[ss.mode()]
                            "></div>
                            <div class="shop_slot">
                                <!-- ko if: ss.part() -->
                                    <!-- ko with: {ss: ss, part: ss.part(), shell: ss.shell } -->
                                        <!-- ko template: {
                                                name: 'kot/part.html',
                                                data: part,
                                                as: 'part',
                                                shell: ss.shell,
                                        } --><!-- /ko -->
                                    <!-- /ko -->
                                <!-- /ko -->
                            </div>
                            <!-- ko if: ss.part() -->
                            <div class="shop_price">
                                <i class="icon-mana"></i>
                                <span data-bind="text: ss.part().mana_cost().formatBig()"></span>
                            </div>
                            <!-- /ko -->
                            <!-- ko if: ss.mode() === 'single' || ss.mode() === 'multi' -->
                            <div>
                                <button data-bind="click: function() { ss.restock(); }">Reroll</button>
                                <!-- ko if: ss.mode() === 'single' -->
                                <button data-bind="click: function() {ss.next_stat();}, right_click: function() {ss.prev_stat();}, event:{mousewheel: function(handler,event)
                                        {
                                            if(event.originalEvent.wheelDelta<0)
                                            {
                                                ss.next_stat();
                                            }
                                            else
                                            {
                                                ss.prev_stat();
                                            }
                                        }}">&#60; &#62;</button>
                                <!-- /ko -->
                            </div>
                            <!-- /ko -->
                            <div class="tier_selector" data-bind="visible: ss.max_tier() > 1,
                                 event:{mousewheel: function(handler,event)
                                        {
                                            if(event.originalEvent.wheelDelta<0)
                                            {
                                            if(ss.tier()< ss.max_tier())
                                                {
                                                    ss.tier.inc(1);
                                                    ss.restock();
                                                    return;
                                                }
                                            }
                                            else
                                            {
                                            if(ss.tier()>1)
                                                {
                                                    ss.tier.inc(-1);
                                                    ss.restock();
                                                    return;
                                                }
                                            }
                                        }}
                                 ">
                                <button class="tier_down" data-bind="
                                    disable: ss.tier() <= 1,
                                    click: function() {
                                        ss.tier.inc(-1);
                                        ss.restock();
                                    }
                                ">-</button>
                                <span class="tier" data-bind="text: ss.tier()"></span>
                                <button class="tier_up" data-bind="
                                    disable: ss.tier() >= ss.max_tier(),
                                    click: function() {
                                        ss.tier.inc(1);
                                        ss.restock();
                                    }
                                ">+</button>

                            </div>
                        </div>
                    <!-- /ko -->
                </div>

            </div>
        </script>
        <script type="text/html" id="kot/status_bar.html" src="./fractory_files/status_bar.html" ><table class="game_stats">
            <tbody>
                <tr>
                    <th>Mana</th>
                    <td>
                        <i class="icon-mana"></i>
                        <span class="mana" data-bind="text: game.mana().formatBig()"></span>
                        (+<span class="generated" data-bind="text: game.mana_generated().formatBig()"></span>
                        -<span class="spent" data-bind="text: (function() {
                            var tot = 0;
                            _.each(game.spent_mana(), function(sm) {
                                tot += sm.val();
                            });
                            return tot;
                        })().formatBig()

                        "></span> =
                        <span class="mana" data-bind="text: (game.net_mana() >= 0 ?
                        '+' : '') + game.net_mana().formatBig()"></span>/tick)
                    </td>
                </tr>
                <tr>
                    <th>Arcana</th>
                    <td>
                        <span class="arcana" data-bind="text: game.arcana().formatBig()"></span>
                        (+<span class="generated" data-bind="text: game.arcana_generated().formatBig()"></span>/tick)
                    </td>



                </tr>
            </tbody>
        </table></script>

</head>
<body>
    <div id="game_render" data-bind="template: { name: 'kot/game.html', data: game, as: 'game' },">&nbsp;
        <button data-bind="
            visible: game.shell() && !!game.view_shell().in_part() && !game.view_shell().zoom_out(),
            click: _.bind(game.zoom_out, game)
            ">Zoom Out</button>


        <div class="part_sandbox">

	<div class="inventory_holder">
		<div class="inventory_label">Held</div>
	<!-- ko foreach: {
		data: game.inventory_slots(),
		as: 'islot'
	} -->
		<!-- ko template: {
			name: 'kot/inventory_slot.html',
			data: islot,
			as: 'islot',
		} --><!-- /ko -->

	<!-- /ko -->
		<div class="clear trash_label">Trash</div>
	<!-- ko template: {
		name: 'kot/trash_slot.html',
		data: game,
		as: 'game'
	} --><!-- /ko -->
	</div>

	<div class="shell_holder" data-bind="css: game.paused() ? 'paused' : ''">
	<!-- ko if: game.shell() -->

		<!-- ko foreach: {data: game.shell_renders(), as: 'shell' } -->
		<div class="shell" data-bind="
			style: {
				width: shell.elsize.x,
				height: shell.elsize.y,
			},
			shell_render: shell,
			right_click: _.bind(shell.right_click, shell),

		">

			<div class="nodes">
				<!-- ko foreach: {data: _.values(shell.nodes), as: 'node'} -->
					<div class="node" data-bind="
						css: 'node_' + node.loc,
						style: {
							width: node.elsize.x,
							height: node.elsize.y,
							left: node.pos.x,
							top: node.pos.y,
						},
						dropzone: {
							ondropenter: function(ev) {
								console.log('ondropenter', ev);
								ev.draggable.dropped_on = node;
							},
							ondropleave: function(ev) {
								console.log('ondropleave', ev);
								ev.draggable.dropped_on = null;
							},

							ondrop: function(ev) {
								console.log('ondrop', ev);
								if(game.animating_shell()) return;

								node.set_part(ev.draggable.dragObject);
							},
							overlap: 'center'
						},
						double_tap: _.bind(node.double_tap, node),
						right_click: _.bind(node.right_click, node),
						event: {
							mouseover: function(node, event) {
								game.hovered_node(node);
							},
							mouseout: function(node, event) {
								if(game.hovered_node() !== node) return;
								game.hovered_node(null);
							}
						}
					">
						<div class="node_raph" data-bind="
							raphael: _.bind(node.raph, node)
						">
						</div>
						<!-- ko if: node.part() -->
							<!-- ko with: {part: node.part(), shell: node.shell } -->
								<!-- ko template: {
									name: 'kot/part.html',
									data: part,
									as: 'part',
									shell: node.shell,
								} --> <!-- /ko -->
							<!-- /ko -->
						<!-- /ko -->
					</div>
				<!-- /ko -->
			</div>
			<div class="links">
			<!-- ko foreach: {
				data: _.values(shell.nodes), as: 'node'
			} -->
			<!-- ko foreach: {
				data: _.filter(node.links, function(link) {
					return link.primary();
					return link.flow() === 'down' || (link.flow() !== 'up' && link.primary()) || !link.pair_link();
				}),
				as: 'link'
			} -->
				<div class="link" data-bind="
					style: {
						width: link.elsize.x,
						height: link.elsize.y,
						left: link.pos.x,
						top: link.pos.y,
						transform: link.rotate_transform
					},
					css: (function() {
						var classes = link.flow();
						classes += ' dir_' + link.direction();
						if(link.active()) classes += ' active';
						return classes;
					})(),
					
				">

					<div class="stripe_holder" data-bind="

						css: link.stripe_holder_css()
					">
						<div class="inner_stripe_holder">
							<div class="link_stripe"></div>
							<div class="link_stripe"></div>
							<div class="link_stripe"></div>
						</div>
					</div>
					<!-- ko if: false -->
					<div class="flow_arrow" data-bind="
						text: !link.active() ? '' :
							  link.flow_direction() === link.direction() ? '--->' :
						      link.flow_direction() === null ? '|' :
						      '<---'
					"></div>
					<!-- /ko -->
					<span data-bind="visible: false, text: link.node().loc + '->' + (link.pair_link() ? link.pair_link().node().loc : '') + (link.active() ? link.flow() : '')"></span>
				</div>

			<!-- /ko -->
			<!-- /ko -->
			</div>

		</div>
		<!-- /ko -->
		<!-- /ko -->
	</div>
	<!-- ko template: {
		name: 'kot/shop_bar.html',
		data: game,
		as: 'game'
	} --><!-- /ko -->
	<div class="clear"></div>
	<div class="status_bar">
		<!-- ko template: { name: 'kot/status_bar.html', data: game, as: 'game' } --><!-- /ko -->
	</div>
	<div class="panes">
		<div class="pane_chooser">
			<!-- ko foreach: {
				data: [
					{'pane' : 'stats', label: 'Reflect'},
					{pane: 'upgrades', label: 'Enchant'},
					{pane: 'talents', label: 'Ascend'},

				],
				as: 'pb'
			} -->
				<a class="pane_button" data-bind="
					css: game.current_pane() === pb.pane ? 'active' : '',
					click: function() { game.current_pane(pb.pane); }
				">
					<span data-bind="text: pb.label"></span>
					<!-- ko if: pb.pane === 'talents' && game.level_after_ascend() - game.level() > 0 -->
					(<span data-bind="text: game.level_after_ascend() - game.level()"></span>)
					<!-- /ko -->

				</a>
			<!-- /ko -->
			<a class="pane_button" data-bind="
				click: function() { game.save_game(); }
			">
				<span data-bind="text: 'Saved ' + game.save_ticks() + ' secs ago'"></span>
			</a>

			<a class="pane_button" data-bind="
				click: function() { game.paused() ? game.unpause() : game.pause(); }
			">
				<span data-bind="text: game.paused() ? 'Paused' : 'Pause'"></span>
			</a>


		</div>
		<!-- ko template: { name: 'kot/panes/stats_pane.html', data: game, as: 'game' } --><!-- /ko -->
		<!-- ko template: { name: 'kot/panes/shop_pane.html', data: game, as: 'game' } --><!-- /ko -->
		<!-- ko template: { name: 'kot/panes/research_pane.html', data: game, as: 'game' } --><!-- /ko -->
		<!-- ko template: { name: 'kot/panes/upgrades_pane.html', data: game, as: 'game' } --><!-- /ko -->
		<!-- ko template: { name: 'kot/panes/talents_pane.html', data: game, as: 'game' } --><!-- /ko -->


	</div>
</div>

    </div>
<div id="scene_holder"></div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87727098-1', 'auto');
  ga('send', 'pageview');

</script>
</body></html>